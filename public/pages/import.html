<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>درون‌ریزی داده‌ها</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="/assets/css/theme-typography.css">
  <link rel="stylesheet" href="/assets/css/header-footer.css">
  <link rel="stylesheet" href="/assets/css/import.css?v=7">
  <style>
    /* استایل دکمه‌ها و جدول پیش‌نمایش */
    .btn-primary, .btn-secondary, .btn-light {
      border: none;
      border-radius: 9px;
      cursor: pointer;
      font-family: inherit;
      font-weight: 700;
      font-size: 14px;
      padding: 11px 20px;
      display: inline-flex;
      align-items: center;
      gap: 7px;
      transition: background 0.18s, box-shadow 0.18s;
      box-shadow: 0 2px 8px #e0e7ff33;
      outline: none;
    }
    .btn-primary {
      background: linear-gradient(90deg, #2563eb 80%, #0d9488 100%);
      color: #fff;
    }
    .btn-primary:hover {
      background: linear-gradient(90deg, #1d4ed8 80%, #0d9488 100%);
      box-shadow: 0 4px 16px #2563eb55;
    }
    .btn-secondary {
      background: linear-gradient(90deg, #0d9488 80%, #2563eb 100%);
      color: #fff;
    }
    .btn-secondary:hover {
      background: linear-gradient(90deg, #0f766e 80%, #2563eb 100%);
      box-shadow: 0 4px 16px #0d948855;
    }
    .btn-light {
      background: #e5e7eb;
      color: #111;
    }
    .btn-light:hover {
      background: #d1d5db;
      color: #2563eb;
      box-shadow: 0 2px 8px #94a3b833;
    }
    .btn-primary:active, .btn-secondary:active, .btn-light:active {
      transform: scale(0.97);
    }

    .import-preview-wrapper {
      max-width: 100%;
      overflow-x: auto;
      background: #f8fafc;
      border-radius: 10px;
      border: 1px solid #d5dbe6;
      margin-bottom: 18px;
      box-shadow: 0 2px 16px #dbeafe38;
      padding: 6px 2px;
    }
    .import-preview-table {
      font-size: 10px;
      border-collapse: collapse;
      min-width: 900px;
      width: max-content;
      max-width: 100%;
      background: #fff;
      table-layout: fixed;
      border-radius: 9px;
    }
    .import-preview-table th,
    .import-preview-table td {
      padding: 3px 6px !important;
      border: 1px solid #e3e5e7;
      text-align: center !important;
      vertical-align: middle !important;
      font-family: inherit;
      font-size: 10px !important;
      white-space: nowrap !important;
      overflow: hidden;
      text-overflow: ellipsis;
      line-height: 1.4;
      font-weight: 500;
      max-width: 110px;
    }
    .import-preview-table th {
      background: linear-gradient(90deg,#e0e7ff 60%,#f1f5f9 100%);
      font-weight: 700;
      color: #2563eb;
      font-size: 10px !important;
      border-bottom: 2px solid #b6c1e6;
    }
    .import-preview-table tbody tr:nth-child(even){background:#f3f7fc;}
    .import-preview-table tbody tr:hover{background:#e8f0fe;}
    .import-preview-wrapper::-webkit-scrollbar {
      height:7px;
      background:#e0e7ff;
      border-radius:8px;
    }
    .import-preview-wrapper::-webkit-scrollbar-thumb {
      background:#94a3b8;
      border-radius:8px;
    }
  </style>
</head>
<body>
  <div id="navbar"></div>
  <header class="topbar"><h1>درون‌ریزی داده‌ها</h1></header>
  <main class="wrapper">
    <section class="panel">
      <div class="form-grid">
        <div>
          <label for="dataset">دیتاست</label>
          <select id="dataset">
            <option value="factories">کارخانه</option>
            <option value="source">ثبت منبع</option>
            <option value="tech">مسئول فنی</option>
            <option value="irc">IRC</option>
            <option value="whitelist">Whitelist</option>
          </select>
        </div>
        <div>
          <label for="file">فایل (CSV / XLSX)</label>
          <input type="file" id="file" accept=".csv,.xls,.xlsx">
        </div>
        <div>
          <label for="sheetSelect">Sheet</label>
          <select id="sheetSelect" disabled></select>
        </div>
        <div>
          <label for="batchId">Batch ID</label>
          <input type="text" id="batchId" placeholder="خالی=زمان">
        </div>
        <div style="display:flex;align-items:flex-end;gap:6px;">
          <button id="autoMapBtn" type="button" class="btn-secondary">نگاشت خودکار</button>
          <button id="clearBtn" type="button" class="btn-light">پاک‌سازی گزارش</button>
        </div>
      </div>
    </section>
    <section class="panel">
      <label for="extraData">extra_data JSON (اختیاری)</label>
      <textarea id="extraData" placeholder='{"source":"manual"}'></textarea>
    </section>
    <section class="panel actions">
      <button id="startBtn" class="btn-primary" type="button">شروع درون‌ریزی</button>
      <span id="status" class="status"></span>
    </section>
    <section class="panel">
      <h2>نگاشت فیلدهای دیتاست → ستون فایل</h2>
      <div id="mappingArea" class="mapping-area-dataset"></div>
      <div id="unusedWrapper" style="margin-top:14px;">
        <strong>ستون‌های فایل بدون استفاده:</strong>
        <div id="unusedHeaders" style="font-size:12px;color:#555;line-height:1.6;"></div>
      </div>
    </section>
    <section class="panel">
      <h2>پیش‌نمایش (۲۰ ردیف اول فایل)</h2>
      <div class="import-preview-wrapper">
        <table id="preview" class="import-preview-table"><thead></thead><tbody></tbody></table>
      </div>
    </section>
    <section class="panel">
      <h2>گزارش عملیات</h2>
      <pre id="log" class="log"></pre>
    </section>
  </main>
  <div id="footer"></div>
  <script src="/assets/js/xlsx.full.min.js"></script>
  <script src="/assets/js/importer.js?v=7"></script>
  <script>
    function loadComponent(id, url) {
      fetch(url)
        .then(resp => resp.text())
        .then(html => document.getElementById(id).innerHTML = html)
        .catch(() => document.getElementById(id).innerHTML = "<div style='color:red;'>مشکل بارگذاری...</div>");
    }
    loadComponent('navbar', '/pages/navbar.html');
    loadComponent('footer', '/pages/footer.html');
  </script>
</body>
</html>